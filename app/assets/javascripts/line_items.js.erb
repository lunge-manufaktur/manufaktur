/*// change any of the quantity inputs
$('form').on('change', '.size-input', function () {
    var product_id = $(this).closest('section').find('.order_line_items_product_id').val();
    var line_item_id = $(this).closest('section').data('line-item-id');
    var quantity = 0;
    
    $(this).closest('section').find('.size-input').each(function() {
        quantity += Number($(this).val());
    });

    console.log('line_items#change_quantity triggered');
    console.log(
        'quantity: ' + quantity + '\n' +
        'product_id: ' + product_id + '\n' +
        'line_item_id: ' + line_item_id
    );

    $.ajax({
        url: "/line_items/change_quantity",
        type: "post",
        data: {
            "product_id": product_id,
            "line_item_id": line_item_id,
            "quantity": quantity
        },
        error: function(data) {
            alert("Fehler");
        },
        success: function(data) {}
    });
});*/


// submit on change
$('form').on('change', '.size-input', function () {
    var key = $(this).data('key');
    var value = $(this).val();
    var line_item_id = $(this).closest('section').data('line-item-id');

    var data = {}
    data['line_items']["key"] = value;
    data['line_items']["id"] = line_item_id;
    console.log(data);

    $.ajax({
        url: "/api/line_items/" + line_item_id,
        type: "patch",
        data: data,
        error: function(data) {
            console.log("Fehler");
        },
        success: function(data) {}
    });
});




// select product_id
$('body').on('change', '.order_line_items_product_id', function () {
    var data = {
        "line_item_id": $(this).closest('section').data('line-item-id'),
        "product_id": $(this).val(),
        "quantity": $(this).closest('section').find('#quantity').text().toFloat
    }

    console.log('line_items#select_product triggered');
    console.log(data);

    $.ajax({
        url: "/line_items/select_product",
        data: data,
        type: "post",
        
        success: function(data) {
            data
        }
    });
});



// selectize inputs of line items that are added after page load
$(document).on('nested:fieldAdded', function(event){
    var field = event.field;
    var lineItemDiv = field.find('.line_item');
    var selectProductField = field.find('.order_line_items_product_id');

    lineItemDiv.attr("data-item-temp-id", Math.random());

    selectProductField.selectize({
        dropdownParent: "body"
    });
})